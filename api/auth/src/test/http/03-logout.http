###
# POST /api/v1/auth/logout - 로그아웃 API 테스트
# Description: Refresh Token을 무효화하여 로그아웃
# Note: Authorization 헤더에 Access Token 필요
###

### 사전 준비: 로그인하여 토큰 받기
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "email": "{{testEmail}}",
  "password": "{{testPassword}}"
}

> {%
    client.global.set("accessToken", response.body.data.accessToken);
    client.global.set("refreshToken", response.body.data.refreshToken);
%}

### 1. 정상적인 로그아웃
POST {{baseUrl}}/api/v1/auth/logout
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "refreshToken": "{{refreshToken}}"
}

> {%
    client.test("로그아웃 성공", function() {
        client.assert(response.status === 200, "응답 상태 코드가 200이어야 합니다");
        client.assert(response.body.code === "2000", "code 필드가 2000이어야 합니다");
    });
    
    // 로그아웃 후 토큰 제거
    client.global.clear("accessToken");
    client.global.clear("refreshToken");
%}

### 2. 실패 케이스 - Refresh Token 누락
POST {{baseUrl}}/api/v1/auth/logout
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
}

> {%
    client.test("유효성 검증 실패", function() {
        client.assert(response.status === 400, "응답 상태 코드가 400이어야 합니다");
    });
%}

### 3. 실패 케이스 - 빈 Refresh Token
POST {{baseUrl}}/api/v1/auth/logout
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "refreshToken": ""
}

> {%
    client.test("유효성 검증 실패", function() {
        client.assert(response.status === 400, "응답 상태 코드가 400이어야 합니다");
    });
%}

### 4. 실패 케이스 - Authorization 헤더 없음
POST {{baseUrl}}/api/v1/auth/logout
Content-Type: application/json

{
  "refreshToken": "{{refreshToken}}"
}

> {%
    client.test("인증 실패", function() {
        client.assert(response.status === 401 || response.status === 403, "응답 상태 코드가 401 또는 403이어야 합니다");
    });
%}

### 5. 실패 케이스 - 잘못된 Access Token
POST {{baseUrl}}/api/v1/auth/logout
Content-Type: application/json
Authorization: Bearer invalid_token

{
  "refreshToken": "{{refreshToken}}"
}

> {%
    client.test("인증 실패", function() {
        client.assert(response.status === 401, "응답 상태 코드가 401이어야 합니다");
    });
%}
