###
# POST /api/v1/auth/reset-password/confirm - 비밀번호 재설정 확인 API 테스트
# Description: 비밀번호 재설정 토큰과 새 비밀번호로 비밀번호 변경
# Note: 먼저 06-reset-password.http에서 토큰 발급 후 http-client.private.env.json에 저장
###

### 사전 준비: 비밀번호 재설정 요청
POST {{baseUrl}}/api/v1/auth/reset-password
Content-Type: application/json

{
  "email": "{{testEmail}}"
}

> {%
    client.test("재설정 요청 성공", function() {
        client.assert(response.status === 200, "응답 상태 코드가 200이어야 합니다");
    });
%}

### 1. 정상적인 비밀번호 재설정 확인
POST {{baseUrl}}/api/v1/auth/reset-password/confirm
Content-Type: application/json

{
  "token": "{{resetPasswordToken}}",
  "newPassword": "NewPassword123!"
}

> {%
    client.test("비밀번호 변경 성공", function() {
        client.assert(response.status === 200, "응답 상태 코드가 200이어야 합니다");
        client.assert(response.body.code === "2000", "code 필드가 2000이어야 합니다");
    });
%}

### 2. 비밀번호 최소 조건 (8자, 영문+숫자)
POST {{baseUrl}}/api/v1/auth/reset-password/confirm
Content-Type: application/json

{
  "token": "{{resetPasswordToken}}",
  "newPassword": "NewPass1"
}

> {%
    client.test("비밀번호 변경 성공", function() {
        client.assert(response.status === 200, "응답 상태 코드가 200이어야 합니다");
    });
%}

### 3. 실패 케이스 - 토큰 누락
POST {{baseUrl}}/api/v1/auth/reset-password/confirm
Content-Type: application/json

{
  "newPassword": "NewPassword123!"
}

> {%
    client.test("유효성 검증 실패", function() {
        client.assert(response.status === 400, "응답 상태 코드가 400이어야 합니다");
    });
%}

### 4. 실패 케이스 - 비밀번호 누락
POST {{baseUrl}}/api/v1/auth/reset-password/confirm
Content-Type: application/json

{
  "token": "{{resetPasswordToken}}"
}

> {%
    client.test("유효성 검증 실패", function() {
        client.assert(response.status === 400, "응답 상태 코드가 400이어야 합니다");
    });
%}

### 5. 실패 케이스 - 비밀번호 너무 짧음 (8자 미만)
POST {{baseUrl}}/api/v1/auth/reset-password/confirm
Content-Type: application/json

{
  "token": "{{resetPasswordToken}}",
  "newPassword": "Pass1"
}

> {%
    client.test("유효성 검증 실패", function() {
        client.assert(response.status === 400, "응답 상태 코드가 400이어야 합니다");
    });
%}

### 6. 실패 케이스 - 비밀번호 패턴 불일치 (영문만)
POST {{baseUrl}}/api/v1/auth/reset-password/confirm
Content-Type: application/json

{
  "token": "{{resetPasswordToken}}",
  "newPassword": "PasswordOnly"
}

> {%
    client.test("유효성 검증 실패", function() {
        client.assert(response.status === 400, "응답 상태 코드가 400이어야 합니다");
    });
%}

### 7. 실패 케이스 - 잘못된 토큰
POST {{baseUrl}}/api/v1/auth/reset-password/confirm
Content-Type: application/json

{
  "token": "invalid_token",
  "newPassword": "NewPassword123!"
}

> {%
    client.test("토큰 검증 실패", function() {
        client.assert(response.status === 400 || response.status === 404, "응답 상태 코드가 400 또는 404여야 합니다");
    });
%}

### 8. 비밀번호 재설정 후 새 비밀번호로 로그인 테스트
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "email": "{{testEmail}}",
  "password": "NewPassword123!"
}

> {%
    client.test("새 비밀번호로 로그인 성공", function() {
        client.assert(response.status === 200, "응답 상태 코드가 200이어야 합니다");
        client.assert(response.body.code === "2000", "로그인에 성공해야 합니다");
        
        // 토큰 저장
        client.global.set("accessToken", response.body.data.accessToken);
        client.global.set("refreshToken", response.body.data.refreshToken);
    });
%}

### 9. 이전 비밀번호로 로그인 시도 (실패해야 함)
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "email": "{{testEmail}}",
  "password": "{{testPassword}}"
}

> {%
    client.test("이전 비밀번호 로그인 실패", function() {
        client.assert(response.status === 401, "응답 상태 코드가 401이어야 합니다");
        client.assert(response.body.code !== "2000", "로그인에 실패해야 합니다");
    });
%}

###
# 사용 방법:
# 1. 먼저 "사전 준비: 비밀번호 재설정 요청" 실행
# 2. 이메일에서 비밀번호 재설정 링크 확인하고 토큰 추출
# 3. http-client.private.env.json의 resetPasswordToken에 토큰 저장
# 4. 각 테스트 케이스 실행
# 5. 비밀번호 변경 후 로그인 테스트로 확인
#
# 토큰 저장 예시 (http-client.private.env.json):
# {
#   "local": {
#     "resetPasswordToken": "your-actual-reset-token-here"
#   }
# }
#
# 비밀번호 요구사항:
# - 최소 8자 이상
# - 영문 대소문자/숫자/특수문자 중 2가지 이상 조합
