###
# POST /api/v1/auth/login - 로그인 API 테스트
# Description: 이메일과 비밀번호로 로그인 후 Access Token과 Refresh Token 받기
###

### 1. 정상적인 로그인 (토큰 자동 저장)
POST {{gatewayUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "email": "{{testEmail}}",
  "password": "{{testPassword}}"
}

> {%
    client.test("로그인 성공", function() {
        client.assert(response.status === 200, "응답 상태 코드가 200이어야 합니다");
        client.assert(response.body.code === "2000", "code 필드가 2000이어야 합니다");
    });
    
    client.test("토큰 발급 확인", function() {
        var data = response.body.data;
        client.assert(data.accessToken !== undefined, "accessToken이 존재해야 합니다");
        client.assert(data.refreshToken !== undefined, "refreshToken이 존재해야 합니다");
        
        // 환경 변수에 토큰 자동 저장
        client.global.set("accessToken", data.accessToken);
        client.global.set("refreshToken", data.refreshToken);
    });
%}

### 2. 다른 사용자 로그인
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "email": "john.doe@example.com",
  "password": "SecurePass99!"
}

> {%
    client.test("로그인 성공", function() {
        client.assert(response.status === 200, "응답 상태 코드가 200이어야 합니다");
    });
%}

### 3. 실패 케이스 - 이메일 누락
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "password": "Password123!"
}

> {%
    client.test("유효성 검증 실패", function() {
        client.assert(response.status === 400, "응답 상태 코드가 400이어야 합니다");
    });
%}

### 4. 실패 케이스 - 비밀번호 누락
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "email": "test@example.com"
}

> {%
    client.test("유효성 검증 실패", function() {
        client.assert(response.status === 400, "응답 상태 코드가 400이어야 합니다");
    });
%}

### 5. 실패 케이스 - 잘못된 이메일 형식
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "email": "invalid-email",
  "password": "Password123!"
}

> {%
    client.test("유효성 검증 실패", function() {
        client.assert(response.status === 400, "응답 상태 코드가 400이어야 합니다");
    });
%}

### 6. 실패 케이스 - 존재하지 않는 이메일
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "email": "notexist@example.com",
  "password": "Password123!"
}

> {%
    client.test("인증 실패", function() {
        client.assert(response.status === 401, "응답 상태 코드가 401이어야 합니다");
    });
%}

### 7. 실패 케이스 - 잘못된 비밀번호
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "WrongPassword123!"
}

> {%
    client.test("인증 실패", function() {
        client.assert(response.status === 401, "응답 상태 코드가 401이어야 합니다");
    });
%}

### 8. 실패 케이스 - 빈 문자열
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "email": "",
  "password": ""
}

> {%
    client.test("유효성 검증 실패", function() {
        client.assert(response.status === 400, "응답 상태 코드가 400이어야 합니다");
    });
%}
