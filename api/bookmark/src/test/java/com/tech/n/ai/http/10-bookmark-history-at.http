###
# GET /api/v1/bookmark/history/{entityId}/at - 특정 시점 데이터 조회 API 테스트
# Description: 특정 시점의 북마크 데이터를 조회합니다.
# Authentication: Required (Bearer Token)
###

### 1. 특정 시점 데이터 조회 성공
GET {{gatewayUrl}}/api/v1/bookmark/history/{{testBookmarkId}}/at?timestamp=2026-02-03T13:53:22
Authorization: Bearer {{accessToken}}

> {%
    client.test("특정 시점 조회 성공", function() {
        client.assert(response.status === 200, "응답 상태 코드가 200이어야 합니다");
        client.assert(response.body.code === "2000", "code 필드가 2000이어야 합니다");
    });
%}

### 2. 현재 시점 조회
GET {{gatewayUrl}}/api/v1/bookmark/history/{{testBookmarkId}}/at?timestamp=2026-02-03T13:53:22
Authorization: Bearer {{accessToken}}

> {%
    client.test("현재 시점 조회 성공", function() {
        client.assert(response.status === 200, "응답 상태 코드가 200이어야 합니다");
    });
%}

### 3. 실패 케이스 - timestamp 파라미터 누락
GET {{gatewayUrl}}/api/v1/bookmark/history/{{testBookmarkId}}/at
Authorization: Bearer {{accessToken}}

> {%
    client.test("timestamp 누락 오류", function() {
        client.assert(response.status === 400, "응답 상태 코드가 400이어야 합니다");
        client.assert(response.body.code === "4006", "code 필드가 4006(VALIDATION_ERROR)이어야 합니다");
    });
%}

### 4. 실패 케이스 - 잘못된 timestamp 형식
GET {{gatewayUrl}}/api/v1/bookmark/history/{{testBookmarkId}}/at?timestamp=invalid-timestamp
Authorization: Bearer {{accessToken}}

> {%
    client.test("잘못된 timestamp 형식 오류", function() {
        client.assert(response.status === 400, "응답 상태 코드가 400이어야 합니다");
        client.assert(response.body.code === "4006", "code 필드가 4006(VALIDATION_ERROR)이어야 합니다");
    });
%}

### 5. 실패 케이스 - 존재하지 않는 엔티티 ID (유효한 형식)
GET {{gatewayUrl}}/api/v1/bookmark/history/999999999999999999/at?timestamp=2026-01-01T00:00:00
Authorization: Bearer {{accessToken}}

> {%
    client.test("엔티티 없음 오류", function() {
        client.assert(response.status === 404, "응답 상태 코드가 404이어야 합니다");
        client.assert(response.body.code === "4004", "code 필드가 4004(NOT_FOUND)이어야 합니다");
    });
%}

### 5-1. 실패 케이스 - 유효하지 않은 엔티티 ID 형식
GET {{gatewayUrl}}/api/v1/bookmark/history/invalid-id-format/at?timestamp=2026-01-01T00:00:00
Authorization: Bearer {{accessToken}}

> {%
    client.test("ID 형식 오류", function() {
        client.assert(response.status === 400, "응답 상태 코드가 400이어야 합니다");
        client.assert(response.body.code === "4006", "code 필드가 4006(VALIDATION_ERROR)이어야 합니다");
    });
%}

### 6. 실패 케이스 - 데이터 존재 이전 시점 조회
GET {{gatewayUrl}}/api/v1/bookmark/history/{{testBookmarkId}}/at?timestamp=2000-01-01T00:00:00
Authorization: Bearer {{accessToken}}

> {%
    client.test("데이터 없는 시점 오류", function() {
        client.assert(response.status === 404 || response.status === 200,
            "응답 상태 코드가 404 또는 200이어야 합니다");
    });
%}

### 7. 실패 케이스 - 인증 없이 요청
GET {{gatewayUrl}}/api/v1/bookmark/history/{{testBookmarkId}}/at?timestamp=2026-01-01T00:00:00

> {%
    client.test("인증 필요 오류", function() {
        client.assert(response.status === 401, "응답 상태 코드가 401이어야 합니다");
    });
%}

### 8. 실패 케이스 - 잘못된 토큰
GET {{gatewayUrl}}/api/v1/bookmark/history/{{testBookmarkId}}/at?timestamp=2026-01-01T00:00:00
Authorization: Bearer invalid_token_here

> {%
    client.test("인증 실패 오류", function() {
        client.assert(response.status === 401, "응답 상태 코드가 401이어야 합니다");
    });
%}
