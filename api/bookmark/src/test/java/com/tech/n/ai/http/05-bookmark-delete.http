###
# DELETE /api/v1/bookmark/{id} - 북마크 삭제 API 테스트
# Description: 특정 북마크를 소프트 삭제합니다.
# Authentication: Required (Bearer Token)
###

### 0. [사전 작업] 삭제용 북마크 생성
POST {{gatewayUrl}}/api/v1/bookmark
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "emergingTechId": "697b1e45a5f3d11fec198110"
}

> {%
    client.test("삭제용 북마크 생성 성공", function() {
        client.assert(response.status === 200, "응답 상태 코드가 200이어야 합니다");
    });

    client.test("삭제할 북마크 ID 저장", function() {
        var data = response.body.data;
        client.global.set("deleteBookmarkId", data.bookmarkTsid);
    });
%}

### 1. 북마크 삭제 성공
DELETE {{gatewayUrl}}/api/v1/bookmark/{{deleteBookmarkId}}
Authorization: Bearer {{accessToken}}

> {%
    client.test("북마크 삭제 성공", function() {
        client.assert(response.status === 200, "응답 상태 코드가 200이어야 합니다");
        client.assert(response.body.code === "2000", "code 필드가 2000이어야 합니다");
    });
%}

### 2. 삭제된 북마크 조회 시도 (삭제 확인)
GET {{gatewayUrl}}/api/v1/bookmark/{{deleteBookmarkId}}
Authorization: Bearer {{accessToken}}

> {%
    client.test("삭제된 북마크 조회 실패", function() {
        client.assert(response.status === 404, "응답 상태 코드가 404이어야 합니다");
    });
%}

### 3. 실패 케이스 - 존재하지 않는 북마크 삭제 (유효한 ID 형식)
DELETE {{gatewayUrl}}/api/v1/bookmark/999999999999999
Authorization: Bearer {{accessToken}}

> {%
    client.test("북마크 없음 오류", function() {
        client.assert(response.status === 404, "응답 상태 코드가 404이어야 합니다");
        client.assert(response.body.code === "4004", "code 필드가 4004이어야 합니다");
    });
%}

### 3-1. 실패 케이스 - 유효하지 않은 북마크 ID 형식
DELETE {{gatewayUrl}}/api/v1/bookmark/invalid-id-format
Authorization: Bearer {{accessToken}}

> {%
    client.test("ID 형식 오류", function() {
        client.assert(response.status === 400, "응답 상태 코드가 400이어야 합니다");
        client.assert(response.body.code === "4006", "code 필드가 4006 (VALIDATION_ERROR)이어야 합니다");
    });
%}

### 4. 실패 케이스 - 이미 삭제된 북마크 다시 삭제
DELETE {{gatewayUrl}}/api/v1/bookmark/{{deleteBookmarkId}}
Authorization: Bearer {{accessToken}}

> {%
    client.test("이미 삭제된 북마크 오류", function() {
        client.assert(response.status === 404, "응답 상태 코드가 404이어야 합니다");
        client.assert(response.body.code === "4004", "code 필드가 4004이어야 합니다");
    });
%}

### 5. 실패 케이스 - 인증 없이 삭제 요청
DELETE {{gatewayUrl}}/api/v1/bookmark/{{testBookmarkId}}

> {%
    client.test("인증 필요 오류", function() {
        client.assert(response.status === 401, "응답 상태 코드가 401이어야 합니다");
    });
%}

### 6. 실패 케이스 - 잘못된 토큰으로 삭제 요청
DELETE {{gatewayUrl}}/api/v1/bookmark/{{testBookmarkId}}
Authorization: Bearer invalid_token_here

> {%
    client.test("인증 실패 오류", function() {
        client.assert(response.status === 401, "응답 상태 코드가 401이어야 합니다");
    });
%}

### 7. 실패 케이스 - 다른 사용자의 북마크 삭제 시도
# Note: 실제 테스트 시에는 다른 사용자의 북마크 ID로 교체 필요
# 현재 구현: 본인 소유가 아닌 북마크 삭제 시도 → UnauthorizedException (401)
DELETE {{gatewayUrl}}/api/v1/bookmark/other-user-bookmark-id
Authorization: Bearer {{accessToken}}

> {%
    client.test("권한 없음 오류", function() {
        // 유효하지 않은 ID 형식(숫자 아님)은 400 (VALIDATION_ERROR)
        // 존재하지 않는 북마크는 404 (NOT_FOUND)
        // 본인 소유 아닌 북마크는 401 (AUTH_FAILED)
        client.assert(response.status === 400 || response.status === 404 || response.status === 401,
            "응답 상태 코드가 400, 401, 또는 404이어야 합니다");
    });
%}
