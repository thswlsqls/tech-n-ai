###
# DELETE /api/v1/chatbot/sessions/{sessionId} - 대화 세션 삭제 API 테스트
# Description: 특정 대화 세션을 삭제합니다.
# Authentication: Required (Bearer Token)
###

### 0. [사전 작업] 삭제용 새 세션 생성
POST {{chatbotUrl}}/api/v1/chatbot
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "message": "삭제 테스트용 세션입니다."
}

> {%
    client.test("세션 생성 성공", function() {
        client.assert(response.status === 200, "응답 상태 코드가 200이어야 합니다");
    });

    client.test("삭제할 세션 ID 저장", function() {
        var data = response.body.data;
        client.global.set("deleteSessionId", data.conversationId);
    });
%}

### 1. 세션 삭제 성공
DELETE {{chatbotUrl}}/api/v1/chatbot/sessions/{{deleteSessionId}}
Authorization: Bearer {{accessToken}}

> {%
    client.test("세션 삭제 성공", function() {
        client.assert(response.status === 200, "응답 상태 코드가 200이어야 합니다");
        client.assert(response.body.success === true, "success 필드가 true여야 합니다");
    });
%}

### 2. 삭제된 세션 조회 시도 (삭제 확인)
GET {{chatbotUrl}}/api/v1/chatbot/sessions/{{deleteSessionId}}
Authorization: Bearer {{accessToken}}

> {%
    client.test("삭제된 세션 조회 실패", function() {
        client.assert(response.status === 404, "응답 상태 코드가 404이어야 합니다");
    });
%}

### 3. 실패 케이스 - 존재하지 않는 세션 삭제
DELETE {{chatbotUrl}}/api/v1/chatbot/sessions/non-existent-session-id-12345
Authorization: Bearer {{accessToken}}

> {%
    client.test("세션 없음 오류", function() {
        client.assert(response.status === 404, "응답 상태 코드가 404이어야 합니다");
    });
%}

### 4. 실패 케이스 - 이미 삭제된 세션 다시 삭제
DELETE {{chatbotUrl}}/api/v1/chatbot/sessions/{{deleteSessionId}}
Authorization: Bearer {{accessToken}}

> {%
    client.test("이미 삭제된 세션 오류", function() {
        client.assert(response.status === 404, "응답 상태 코드가 404이어야 합니다");
    });
%}

### 5. 실패 케이스 - 인증 없이 삭제 요청
DELETE {{chatbotUrl}}/api/v1/chatbot/sessions/{{testSessionId}}

> {%
    client.test("인증 필요 오류", function() {
        client.assert(response.status === 401, "응답 상태 코드가 401이어야 합니다");
    });
%}

### 6. 실패 케이스 - 잘못된 토큰으로 삭제 요청
DELETE {{chatbotUrl}}/api/v1/chatbot/sessions/{{testSessionId}}
Authorization: Bearer invalid_token_here

> {%
    client.test("인증 실패 오류", function() {
        client.assert(response.status === 401, "응답 상태 코드가 401이어야 합니다");
    });
%}

### 7. 실패 케이스 - 다른 사용자의 세션 삭제 시도
DELETE {{chatbotUrl}}/api/v1/chatbot/sessions/other-user-session-id
Authorization: Bearer {{accessToken}}

> {%
    client.test("권한 없음 또는 세션 없음 오류", function() {
        client.assert(response.status === 403 || response.status === 404,
            "응답 상태 코드가 403 또는 404이어야 합니다");
    });
%}

### 8. [보너스] 세션 삭제 후 해당 세션으로 채팅 시도
POST {{chatbotUrl}}/api/v1/chatbot
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "message": "삭제된 세션에서 대화 시도",
  "conversationId": "{{deleteSessionId}}"
}

> {%
    client.test("삭제된 세션으로 채팅 실패", function() {
        client.assert(response.status === 404 || response.status === 400,
            "응답 상태 코드가 404 또는 400이어야 합니다");
    });
%}
