###
# GET /api/v1/chatbot/sessions/{sessionId}/messages - 세션 메시지 목록 조회 API 테스트
# Description: 특정 세션의 메시지 목록을 페이지네이션으로 조회합니다.
# Authentication: Required (Bearer Token)
###

### 1. 메시지 목록 조회 (기본 파라미터)
GET {{gatewayUrl}}/api/v1/chatbot/sessions/{{testSessionId}}/messages
Authorization: Bearer {{accessToken}}

> {%
    client.test("메시지 목록 조회 성공", function() {
        client.assert(response.status === 200, "응답 상태 코드가 200이어야 합니다");
        client.assert(response.body.code === "2000", "code 필드가 2000이어야 합니다");
    });

    client.test("페이지네이션 응답 확인", function() {
        var data = response.body.data;
        client.assert(data.content !== undefined, "content가 존재해야 합니다");
        client.assert(data.totalElements !== undefined, "totalElements가 존재해야 합니다");
        client.assert(data.totalPages !== undefined, "totalPages가 존재해야 합니다");
    });

    client.test("메시지 데이터 형식 확인", function() {
        var data = response.body.data;
        if (data.content && data.content.length > 0) {
            var message = data.content[0];
            client.assert(message.messageId !== undefined, "messageId가 존재해야 합니다");
            client.assert(message.sessionId !== undefined, "sessionId가 존재해야 합니다");
            client.assert(message.role !== undefined, "role이 존재해야 합니다");
            client.assert(message.content !== undefined, "content가 존재해야 합니다");
            client.assert(message.sequenceNumber !== undefined, "sequenceNumber가 존재해야 합니다");
            client.assert(message.createdAt !== undefined, "createdAt이 존재해야 합니다");
        }
    });
%}

### 2. 메시지 목록 조회 (conversationId 사용)
GET {{gatewayUrl}}/api/v1/chatbot/sessions/{{conversationId}}/messages
Authorization: Bearer {{accessToken}}

> {%
    client.test("메시지 목록 조회 성공", function() {
        client.assert(response.status === 200 || response.status === 404,
            "응답 상태 코드가 200 또는 404이어야 합니다");
    });
%}

### 3. 페이지네이션 - 첫 번째 페이지, 10개
GET {{gatewayUrl}}/api/v1/chatbot/sessions/{{testSessionId}}/messages?page=1&size=10
Authorization: Bearer {{accessToken}}

> {%
    client.test("페이지네이션 성공", function() {
        client.assert(response.status === 200, "응답 상태 코드가 200이어야 합니다");
    });

    client.test("페이지 크기 확인", function() {
        var data = response.body.data;
        client.assert(data.size === 10, "페이지 크기가 10이어야 합니다");
    });
%}

### 4. 페이지네이션 - 두 번째 페이지
GET {{gatewayUrl}}/api/v1/chatbot/sessions/{{testSessionId}}/messages?page=2&size=5
Authorization: Bearer {{accessToken}}

> {%
    client.test("두 번째 페이지 조회 성공", function() {
        client.assert(response.status === 200, "응답 상태 코드가 200이어야 합니다");
    });
%}

### 5. 페이지네이션 - 기본값 확인 (size=50)
GET {{gatewayUrl}}/api/v1/chatbot/sessions/{{testSessionId}}/messages?page=1
Authorization: Bearer {{accessToken}}

> {%
    client.test("기본 페이지 크기 확인", function() {
        client.assert(response.status === 200, "응답 상태 코드가 200이어야 합니다");
        var data = response.body.data;
        client.assert(data.size === 50, "기본 페이지 크기가 50이어야 합니다");
    });
%}

### 6. 페이지네이션 - 큰 페이지 번호 (빈 결과)
GET {{gatewayUrl}}/api/v1/chatbot/sessions/{{testSessionId}}/messages?page=100&size=50
Authorization: Bearer {{accessToken}}

> {%
    client.test("빈 페이지 조회 성공", function() {
        client.assert(response.status === 200, "응답 상태 코드가 200이어야 합니다");
    });

    client.test("빈 결과 확인", function() {
        var data = response.body.data;
        client.assert(data.content.length === 0, "결과가 비어있어야 합니다");
    });
%}

### 7. 실패 케이스 - 존재하지 않는 세션 ID
GET {{gatewayUrl}}/api/v1/chatbot/sessions/non-existent-session-id-12345/messages
Authorization: Bearer {{accessToken}}

> {%
    client.test("세션 없음 오류", function() {
        client.assert(response.status === 404, "응답 상태 코드가 404이어야 합니다");
    });
%}

### 8. 실패 케이스 - 인증 없이 요청
GET {{gatewayUrl}}/api/v1/chatbot/sessions/{{testSessionId}}/messages

> {%
    client.test("인증 필요 오류", function() {
        client.assert(response.status === 401, "응답 상태 코드가 401이어야 합니다");
    });
%}

### 9. 실패 케이스 - 잘못된 토큰
GET {{gatewayUrl}}/api/v1/chatbot/sessions/{{testSessionId}}/messages
Authorization: Bearer invalid_token_here

> {%
    client.test("인증 실패 오류", function() {
        client.assert(response.status === 401, "응답 상태 코드가 401이어야 합니다");
    });
%}

### 10. 실패 케이스 - 다른 사용자의 세션 메시지 접근
GET {{gatewayUrl}}/api/v1/chatbot/sessions/other-user-session-id/messages
Authorization: Bearer {{accessToken}}

> {%
    client.test("권한 없음 또는 세션 없음 오류", function() {
        client.assert(response.status === 403 || response.status === 404,
            "응답 상태 코드가 403 또는 404이어야 합니다");
    });
%}
