spring:
  application:
    name: gateway-api
  profiles:
    include:
      - common-core
      - domain-api
      - mongodb-domain
  
  cloud:
    gateway:
      # 라우팅 설정
      routes:
        - id: auth-route
          uri: ${gateway.routes.auth.uri:http://localhost:8082}
          predicates:
            - Path=/api/v1/auth/**
        
        - id: archive-route
          uri: ${gateway.routes.archive.uri:http://localhost:8083}
          predicates:
            - Path=/api/v1/archive/**
        
        - id: contest-route
          uri: ${gateway.routes.contest.uri:http://localhost:8084}
          predicates:
            - Path=/api/v1/contest/**
        
        - id: news-route
          uri: ${gateway.routes.news.uri:http://localhost:8085}
          predicates:
            - Path=/api/v1/news/**
        
        - id: chatbot-route
          uri: ${gateway.routes.chatbot.uri:http://localhost:8086}
          predicates:
            - Path=/api/v1/chatbot/**
      
      # HTTP 클라이언트 연결 풀 설정
      httpclient:
        pool:
          # 연결 풀 설정
          max-idle-time: 30000        # 30초 (백엔드 keep-alive 60초보다 짧게)
          max-life-time: 300000       # 5분 (300초)
          max-connections: 500        # 최대 연결 수
          acquire-timeout: 45000      # 연결 획득 타임아웃 (45초)
          pending-acquire-timeout: 60000  # 대기 타임아웃 (60초)
        # 연결 타임아웃
        connection-timeout: 30000     # 연결 타임아웃 (30초)
        # 소켓 타임아웃
        response-timeout: 60000       # 응답 타임아웃 (60초, 백엔드 타임아웃보다 길게)
      
      # Global CORS 설정
      globalcors:
        cors-configurations:
          '[/**]':
            allowCredentials: true
            allowedOriginPatterns:
              - "http://localhost:*"
              - "http://127.0.0.1:*"
            allowedHeaders: "*"
            allowedMethods: [GET, POST, PUT, PATCH, DELETE, OPTIONS, HEAD]
            maxAge: 3600
      
      # Global default-filters
      default-filters:
        # 외부 API 연동 시 중복 헤더 제거
        - DedupeResponseHeader=Access-Control-Allow-Origin, RETAIN_LAST

server:
  port: 8081
  netty:
    connection-timeout: 3000  # 3초 (클라이언트 연결 타임아웃)

